# PDA 目标跟踪仿真 (PDA Target Tracking Simulation)

一个基于卡尔曼滤波的雷达与相机传感器融合目标跟踪系统，实现了概率数据关联（PDA）算法的仿真。

## 📋 项目简介

本项目实现了一个多传感器融合的目标跟踪系统，结合雷达和相机的测量数据，通过卡尔曼滤波器进行状态估计，显著提高了目标位置估计的准确性。

### 主要特性

- ✅ **多传感器融合**：结合雷达（极坐标测量）和相机（笛卡尔坐标测量）
- ✅ **卡尔曼滤波**：实现标准卡尔曼滤波的预测和更新步骤
- ✅ **PDA算法**：完整实现概率数据关联（PDA）算法，处理杂波环境下的目标跟踪
- ✅ **门控机制**：使用马氏距离进行测量值验证和筛选
- ✅ **关联概率计算**：计算每个候选测量值属于目标的概率
- ✅ **坐标转换**：正确处理极坐标到笛卡尔坐标的转换及噪声协方差变换
- ✅ **可视化展示**：直观展示真实位置、测量值、候选测量值和估计结果
- ✅ **不确定性分析**：显示各传感器和融合估计的不确定性范围

## 🔧 技术栈

- **Python 3.x**
- **NumPy** - 数值计算和矩阵运算
- **Matplotlib** - 数据可视化

## 📦 安装要求

```bash
pip install numpy matplotlib
```

或者使用 requirements.txt：

```bash
pip install -r requirements.txt
```

### requirements.txt

```
numpy>=1.20.0
matplotlib>=3.3.0
```

## 🚀 使用方法

1. 克隆仓库：
```bash
git clone https://github.com/gengyuang5-lang/PDA.git
cd PDA
```

2. 运行仿真：
```bash
python PDA.py
```

3. 查看结果：
   - 控制台会输出详细的跟踪结果和误差分析
   - 自动弹出可视化图表窗口

## 📊 算法说明

### 传感器模型

#### 雷达传感器
- **测量类型**：极坐标（距离、角度）
- **噪声模型**：高斯噪声
  - 距离噪声标准差：0.3
  - 角度噪声标准差：0.05
- **坐标转换**：使用雅可比矩阵将极坐标噪声协方差正确转换为笛卡尔坐标

#### 相机传感器
- **测量类型**：笛卡尔坐标（x, y）
- **噪声模型**：高斯噪声，标准差：0.1

### 卡尔曼滤波算法

#### 状态模型
- **状态向量**：`x = [x, y]` - 目标在笛卡尔坐标系中的位置
- **状态转移矩阵**：`F = I`（单位矩阵，假设目标静止）
- **过程噪声**：`Q = 0.01 * I`（小量不确定性）

#### 测量模型
- **雷达测量矩阵**：`H_radar = I`（极坐标转换后直接测量位置）
- **相机测量矩阵**：`H_camera = I`（直接测量位置）

#### 融合策略
采用顺序更新（Sequential Update）方法：
1. 预测步骤：基于上一时刻状态进行预测
2. 雷达更新：使用雷达测量更新状态
3. 相机更新：使用相机测量进一步更新状态
4. 最终融合估计：结合两个传感器的信息

### PDA算法（概率数据关联）

本项目完整实现了PDA算法，用于在杂波环境下进行目标跟踪。

#### PDA算法核心步骤

1. **候选测量值生成**
   - 生成真实目标测量值（带噪声）
   - 生成杂波测量值（随机分布）
   - 所有候选测量值构成测量集合

2. **门控（Gating）**
   - 使用马氏距离计算每个候选测量值与预测值的距离
   - 根据卡方分布阈值（默认9.21，对应95%置信度）筛选有效测量值
   - 只保留门控内的测量值进行后续处理

3. **关联概率计算**
   - 计算每个有效测量值的似然函数值
   - 基于似然函数和杂波密度计算关联概率
   - 计算无关联概率（所有测量值都是杂波的概率）

4. **PDA更新**
   - 使用关联概率作为权重，对有效测量值进行加权更新
   - 更新状态估计和协方差矩阵
   - 考虑关联不确定性，修正协方差矩阵

#### PDA算法参数

- `num_clutter`: 杂波数量（默认：4）
- `measurement_range`: 测量范围（默认：20）
- `gate_threshold`: 门控阈值（默认：9.21，对应95%置信度）
- `pd`: 检测概率（默认：0.9）
- `lambda_clutter`: 杂波密度（默认：0.1）

### 优化技术

1. **智能初始化**：使用测量值的加权平均作为初始状态，而非从原点开始
2. **雅可比变换**：正确转换极坐标噪声协方差到笛卡尔空间
3. **噪声优化**：降低雷达角度噪声水平，提高测量精度
4. **不确定性建模**：合理设置初始协方差矩阵，反映真实不确定性

## 📈 输出结果

程序会输出以下信息：

### 控制台输出
- 真实目标位置
- 雷达测量值（极坐标和笛卡尔坐标）
- 相机测量值
- **PDA算法执行过程**：
  - 候选测量值列表
  - 门控后有效测量值数量
  - 每个测量值的关联概率
  - PDA估计结果
- 各传感器的单独估计
- 融合后的最终估计
- PDA估计结果
- 位置误差分析（包括PDA误差）

### 可视化图表
图表包含以下元素：
- 🟢 **绿色圆点**：真实目标位置
- 🔴 **红色方块**：雷达测量值
- 🔵 **蓝色方块**：相机测量值
- ⚫ **黑色叉号**：PDA候选测量值（包括真实测量和杂波）
- 🟡 **黄色圆圈**：PDA门控内的有效测量值
- 🟠 **橙色椭圆**：门控区域（验证门）
- 🔺 **红色三角**：仅使用雷达的估计
- 🔺 **蓝色三角**：仅使用相机的估计
- ⭐ **紫色星形**：融合后的最终估计
- 💎 **青色菱形**：PDA估计结果
- **虚线圆圈**：各估计的不确定性范围

## 📐 代码结构

```
PDA.py
├── 导入库和配置
├── 坐标转换函数
│   ├── polar_to_cartesian()          # 极坐标转笛卡尔坐标
│   └── polar_to_cartesian_jacobian() # 雅可比矩阵计算
├── 传感器测量生成
│   ├── generate_radar_measurement()  # 雷达测量仿真
│   └── generate_camera_measurement() # 相机测量仿真
├── PDA算法核心函数
│   ├── generate_candidate_measurements()  # 生成候选测量值（含杂波）
│   ├── gating()                          # 门控机制
│   ├── compute_association_probabilities() # 计算关联概率
│   └── pda_update()                      # PDA更新步骤
├── 卡尔曼滤波核心
│   ├── kalman_predict()              # 预测步骤
│   └── kalman_update()               # 更新步骤
├── 主程序流程
│   ├── 生成测量数据
│   ├── 初始化滤波器
│   ├── 预测和更新
│   ├── PDA算法执行
│   └── 结果输出和可视化
└── 可视化展示
```

## 🎯 性能指标

经过优化后，系统性能显著提升：

| 指标 | 优化前 | 优化后 | 改进 |
|------|--------|--------|------|
| 雷达误差 | ~5.9 | ~0.1-1.0 | **10-40倍** |
| 相机误差 | ~1.1 | ~0.1-0.2 | **5-10倍** |
| 融合误差 | ~1.3 | ~0.1-0.2 | **10-13倍** |
| **PDA误差** | - | **~0.1-0.2** | **新增功能** |

融合估计和PDA估计通常具有最小的误差，证明了传感器融合和PDA算法在杂波环境下的有效性。PDA算法特别适用于存在杂波和误检的场景。

## 🔬 技术细节

### 雅可比矩阵变换

对于极坐标到笛卡尔坐标的转换：
```
x = r * cos(θ)
y = r * sin(θ)
```

雅可比矩阵为：
```
J = [[cos(θ), -r*sin(θ)],
     [sin(θ),  r*cos(θ)]]
```

噪声协方差转换：
```
R_cartesian = J * R_polar * J^T
```

这确保了噪声协方差矩阵在坐标转换后仍然正确。

## 📝 参数配置

可以在代码中调整以下参数：

#### 基础参数
- `true_position`: 真实目标位置（默认：[10, 10]）
- `distance_noise`: 雷达距离噪声标准差（默认：0.3）
- `angle_noise`: 雷达角度噪声标准差（默认：0.05）
- `camera_noise_level`: 相机噪声标准差（默认：0.1）
- `Q`: 过程噪声协方差（默认：0.01 * I）
- `P`: 初始状态协方差（默认：5.0 * I）

#### PDA算法参数
- `num_clutter`: 杂波数量（默认：4）
- `measurement_range`: 测量范围（默认：20）
- `gate_threshold`: 门控阈值（默认：9.21，对应95%置信度）
- `pd`: 检测概率（默认：0.9）
- `lambda_clutter`: 杂波密度（默认：0.1）

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

## 📄 许可证

本项目采用 MIT 许可证。

## 👤 作者

**gengyuang5-lang**

- GitHub: [@gengyuang5-lang](https://github.com/gengyuang5-lang)

## 🙏 致谢

- 感谢卡尔曼滤波算法的发明者 Rudolf E. Kálmán
- 感谢开源社区提供的优秀工具和库

## 📚 参考文献

1. Kalman, R. E. (1960). A new approach to linear filtering and prediction problems. Journal of Basic Engineering, 82(1), 35-45.
2. Bar-Shalom, Y., & Li, X. R. (1995). Multitarget-multisensor tracking: principles and techniques. YBS publishing.
3. Bar-Shalom, Y., & Fortmann, T. E. (1988). Tracking and data association. Academic Press.
4. Probabilistic Data Association (PDA) algorithm for target tracking in clutter environments.

---

⭐ 如果这个项目对您有帮助，请给个 Star！

